<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inscription</title>
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.4.1/semantic.min.css">
</head>
<body>
    <div class="ui raised segment" id="form_login">
        <form action="/login" method="post" class="ui form">
            <h1 class="ui dividing header">Log In</h1>
            <div class="field">
                <div class="ui left icon input">
                    <input type="text" name="username" id="username" autocomplete="username" required placeholder="Username">
                    <i class="user icon"></i>
                </div>
            </div>
            <div class="field">
                <div class="ui left icon input">
                    <input type="text" name="matricule" id="matricule" autocomplete="" required placeholder="Matricule">
                    <i class="user icon"></i>
                </div>
            </div>
            <div class="field">
                <div class="ui left icon input">
                    <input type="password" name="password" id="password" autocomplete="current password" required placeholder="Password">
                    <i class="lock icon"></i>
                </div>
            </div>
            <div class="field">
                <button type="submit" class="ui teal button" id="submit_login">Sign up</button>
            </div>
            <div class="ui divider"></div>
            <small>
                Not registered ? <a href="/signup" class="links">Sign up</a>
            </small>
            <small class="right floated" style="margin-left: 150px;">
                <a href="/mdpforgot">Forgot Password ?</a>
            </small>
        </form>
        <div class="" id="message">
            <div class="header">
                <p style="text-align: center;" id="para"></p>
            </div>

            </div>
        </div>
        <% if (danger) { %>
            <div class="ui warning message" id="message">
                <i class="close icon"></i>
                <div class="header">
                    <%= danger %>
                </div>
            </div>
        <% } %>
    </div>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.4.1/semantic.min.js"></script>

    <script>
        let btn = document.getElementById('submit_login');
        let username = document.getElementById('username');
        let matricule = document.getElementById('matricule');
        let password = document.getElementById('password');

        let test_username = /^[a-zA-Z0-9çéèêëïîÉÈÊËÎÏ_@#-]+$/;
        let test_matricule = /^[0-9]{2}-ESATIC[0-9]{4}[A-Z]{2}$/;
        let test_password = /^\S*$/;

        let mess_div = document.getElementById('message');
        let info_para = document.getElementById('para');

        btn.addEventListener('click', (e)=>{
            mess_div.className = 'ui warning message';
            invalid_syntax(e);
        });

        let invalid_syntax = (e) =>{
            if (username.validity.valueMissing) {
                e.preventDefault();
                info_para.innerHTML = 'Username manquant';
            } else if (test_username.test(username.value) == false) {
                e.preventDefault();
                info_para.innerHTML = 'Username incorrect';
            } else if (matricule.validity.valueMissing) {
                e.preventDefault();
                info_para.innerHTML = 'Matricule manquant';
            } else if (test_matricule.test(matricule.value) ==  false) {
                e.preventDefault();
                info_para.innerHTML = 'Matricule incorrect';
            } else if (password.validity.valueMissing) {
                e.preventDefault();
                info_para.innerHTML = 'Password manquant';
            } else if (test_password.test(password.value) == false) {
                e.preventDefault();
                info_para.innerHTML = 'Password incorrect';
            }
        }
        
    </script>
</body>
</html>